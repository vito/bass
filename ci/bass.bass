(def git (load (*dir*/git)))

(def repo
  (git:resource "https://github.com/vito/bass"))

(defn build [src os arch]
  (let [output (string->fs-path (str "bass-" os "-" arch))]
    ; TODO: the (in-dir src) and the ../ is a litle weird since it assumes
    ; src is mounted into ./foo/
    (-> ($ go build -o (subpath ../ output) ./cmd/bass)
        (in-dir src)
        (with-env {:GOOS os :GOARCH arch :CGO_ENABLED "0"})
        (in-image "golang")
        (path output))))

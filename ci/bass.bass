(def git
  (load (.git "alpine/git")))

(def repo-url
  "https://github.com/vito/bass")

(defn ls-remote [ref]
  (git:ls-remote repo-url ref))

(defn checkout [ref]
  (git:checkout repo-url ref))

(defn build [src os arch]
  (let [output (string->fs-path (str "bass-" os "-" arch))]
    (path
      (from "golang"
        (cd src
          (-> ($ go build -o (subpath ../ output) ./cmd/bass)
              (with-env {:GOOS os :GOARCH arch :CGO_ENABLED "0"}))))
      output)))

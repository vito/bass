#!/usr/bin/env bass

(use (.git (linux/alpine/git))
     (git:github/vito/booklit/ref/HEAD/project))

(def testflags *args*)

(each
  (-> ($ git rev-list "HEAD~10..HEAD")
      (response-from :stdout :unix-table)
      (in-dir project:*root*)
      (in-image (linux/alpine/git))
      run)
  (fn [[sha]]
    (let [src (git:github/vito/booklit/sha/ (string->dir sha))]
      (logf "running tests for %s" sha)
      (run (project:test src testflags)))))

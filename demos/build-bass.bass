; use git stdlib module
(use (.git (linux/alpine/git)))

; returns a path containing binaries compiled from pkg in src
(defn go-build [src pkg]
  (subpath
    (from (linux/golang)
      (cd src
        ($ go build -o ../out/ $pkg)))
    ./out/))

(defn main []
  (let [src git:github/vito/bass/ref/main/
        bins (go-build src "./cmd/...")]
    ; kick the tires
    (run (from (linux/ubuntu)
           ($ bins/bass --version)))

    (emit bins *stdout*)))

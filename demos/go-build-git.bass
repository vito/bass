; use git stdlib module
(use (.git (linux/alpine/git)))

; returns a thunk dir containing compiled binaries
(defn go-build [src pkg]
  (let [thunk (from (linux/golang)
                 (cd src ($ go build -o ../built/ $pkg)))]
    thunk/built/))

(let [src git:github/vito/bass/ref/main/
      bins (go-build src "./cmd/...")]
  ; kick the tires
  (run (from (linux/ubuntu)
         ($ bins/bass --version)))

  (emit bins *stdout*))

(def test-cache-path
  (subpath /test/counter/ (string->fs-path (str (now 0)))))

(defn count [tag]
  (next (run (from "alpine"
               (-> ($ sh -c "echo x >> /var/cache/file; wc -l /var/cache/file")
                   (response-from :stdout)
                   (with-label :tag tag)
                   (with-mount test-cache-path /var/cache/))))))

[(count "once")
 (count "twice")
 (count "thrice")]
